# Shell-Spec v1.0 Implementation Roadmap

This document defines the path from shell-spec's current state to a production-ready v1.0 release. The plan follows semantic versioning with quality-driven milestones.

## Current State

Shell-spec v0.1.0 is feature-complete with:
- Test runner with automatic file discovery (`*_test.sh`)
- Assertion library (10 functions)
- HTML report generation (`--html`)
- Watch mode (`--watch`)
- Progress bar and summary table
- Colorized output with `NO_COLOR` support

## Version Progression

```
v0.1.0 (Current)  →  v0.2.0  →  v0.3.0  →  v0.4.0  →  v0.5.0  →  v0.6.0  →  v1.0.0
   Foundation        TAP       Mocking    Coverage    CI/CD     Distro     Release
```

---

## Milestone Details

### v0.2.0 - TAP Output Support

**Goal**: Enable CI/CD integration via standard TAP 13 protocol

**New Files**:
| File | Description |
|------|-------------|
| `src/tap_reporter.sh` | TAP formatting functions (~80 lines) |

**Modified Files**:
| File | Changes |
|------|---------|
| `src/test_runner.sh` | Add `--tap` flag, integrate reporter |

**Usage**:
```bash
shell-spec --tap              # TAP 13 compliant output
shell-spec --tap tests/       # With custom path
```

**Output Format**:
```
TAP version 13
1..5
ok 1 - test_addition
not ok 2 - test_subtraction
  ---
  message: 'Expected 3, got 4'
  ...
ok 3 - test_multiplication # SKIP not implemented
ok 4 - test_division # TODO edge case
ok 5 - test_modulo
```

**Features**:
- Plan line (`1..N`)
- ok/not ok status with descriptions
- YAML diagnostic blocks for failures
- SKIP and TODO directives

---

### v0.3.0 - Mocking and Stubbing

**Goal**: Enable test isolation by replacing commands/functions

**New Files**:
| File | Description |
|------|-------------|
| `src/mocking.sh` | Mock/stub implementation (~150 lines) |

**Modified Files**:
| File | Changes |
|------|---------|
| `src/test_runner.sh` | Source mocking lib, auto-cleanup after tests |

**API**:
```bash
# In test files:
test_curl_mock() {
    mock_command "curl" "echo 'mocked response'"
    result=$(my_function_that_uses_curl)
    assert_equals "mocked response" "$result"
}
# unmock_all called automatically after each test

test_stub_helper() {
    stub_function "helper_func" "return 0"
    # ... test code
}
```

**Functions**:
| Function | Purpose |
|----------|---------|
| `mock_command <name> <impl>` | Shadow PATH command with shell function |
| `stub_function <name> <impl>` | Replace existing shell function |
| `unmock_all` | Restore all originals (auto-called after each test) |

**Documented Limitations**:
- Cannot mock shell builtins: `cd`, `export`, `source`, `exit`, `eval`, `exec`
- Only works for unqualified command names (not `/usr/bin/curl`)

---

### v0.4.0 - Code Coverage Analysis

**Goal**: Track line execution during tests (Bash 4.0+ only)

**New Files**:
| File | Description |
|------|-------------|
| `src/coverage.sh` | Coverage instrumentation (~200 lines) |

**Modified Files**:
| File | Changes |
|------|---------|
| `src/test_runner.sh` | Add `--coverage` flag |
| `src/report_template.html` | Coverage visualization (optional) |

**Usage**:
```bash
shell-spec --coverage                    # Text coverage report
shell-spec --coverage --html report.html # HTML with coverage
```

**Output**:
```
--- Coverage Report ---
Coverage: src/my_script.sh
  Lines: 45/52 (86%)
Coverage: src/utils.sh
  Lines: 23/30 (76%)
Total: 68/82 (82%)
```

**Implementation**: Uses `trap DEBUG` to intercept line execution

**Documented Limitations** (mark as "experimental"):
- Bash 4.0+ only (not POSIX compatible)
- Does not track: subshells `$()`, process substitution `<()`, backgrounded `&`
- Line coverage only (no branch coverage)
- Performance overhead (~2x slower)

---

### v0.5.0 - CI/CD Integration

**Goal**: Provide ready-to-use CI configurations

**New Files**:
| File | Description |
|------|-------------|
| `.github/workflows/ci.yml` | Main CI workflow (~100 lines) |
| `.github/workflows/release.yml` | Release automation (~120 lines) |
| `.shellcheckrc` | ShellCheck configuration |

**CI Matrix**:
| OS | Shells |
|----|--------|
| ubuntu-latest | bash, zsh, sh |
| ubuntu-22.04 | bash, zsh, sh |
| macos-latest | bash, zsh |
| macos-13 | bash, zsh |

**CI Jobs**:
1. **test** - Run self-tests across platform/shell matrix
2. **lint** - ShellCheck on all `.sh` files
3. **portability** - Alpine Linux (musl libc) test

**Triggers**:
- Push to `main`
- Pull requests to `main`
- Release tags (`v*.*.*`)

---

### v0.6.0 - Package Distribution

**Goal**: Enable easy installation via multiple methods

**New Files**:
| File | Description |
|------|-------------|
| `package.json` | npm package configuration (~35 lines) |
| `bin/shell-spec` | CLI wrapper for npm (~10 lines) |
| `VERSION` | Version tracking (1 line) |
| `CHANGELOG.md` | Release notes (~50 lines) |
| `install.sh` | Universal installer script (~40 lines) |
| `Makefile` | Install/uninstall targets (~30 lines) |

**Installation Methods**:

1. **npm** (primary):
   ```bash
   npm install -g shell-spec
   shell-spec --help
   ```

2. **Homebrew** (requires separate tap repository):
   ```bash
   brew tap <username>/tap
   brew install shell-spec
   ```

3. **curl installer**:
   ```bash
   curl -fsSL https://raw.githubusercontent.com/<repo>/install.sh | bash
   ```

4. **Manual**:
   ```bash
   git clone <repo> && cd shell-spec && make install
   ```

**Version Command**:
```bash
shell-spec --version
# shell-spec v0.6.0
```

---

### v1.0.0 - Production Release

**Pre-release Phases**:

| Phase | Focus |
|-------|-------|
| v1.0.0-alpha.1 | Feature freeze, internal testing |
| v1.0.0-beta.1 | Community testing, bug fixes only |
| v1.0.0-rc.1 | Release candidate, final polish |

**v1.0.0 Readiness Criteria**:
- [ ] All features implemented and tested
- [ ] Framework self-tests pass on all platforms
- [ ] Zero critical/major bugs for 1 week in RC
- [ ] Complete documentation (README, API docs, examples)
- [ ] At least 2 installation methods working
- [ ] CI/CD workflows operational

---

## File Summary

### New Files by Milestone

| Milestone | File | Est. Lines |
|-----------|------|------------|
| v0.2.0 | `src/tap_reporter.sh` | ~80 |
| v0.3.0 | `src/mocking.sh` | ~150 |
| v0.4.0 | `src/coverage.sh` | ~200 |
| v0.5.0 | `.github/workflows/ci.yml` | ~100 |
| v0.5.0 | `.github/workflows/release.yml` | ~120 |
| v0.5.0 | `.shellcheckrc` | ~10 |
| v0.6.0 | `package.json` | ~35 |
| v0.6.0 | `bin/shell-spec` | ~10 |
| v0.6.0 | `install.sh` | ~40 |
| v0.6.0 | `Makefile` | ~30 |
| v0.6.0 | `VERSION` | 1 |
| v0.6.0 | `CHANGELOG.md` | ~50 |

### Modified Files

| File | Milestones | Changes |
|------|------------|---------|
| `src/test_runner.sh` | v0.2.0, v0.3.0, v0.4.0 | Add flags, integrate features |
| `src/report_template.html` | v0.4.0 | Coverage visualization |
| `README.md` | v0.6.0, v1.0.0 | Installation instructions, full docs |

---

## Implementation Order Rationale

1. **TAP first** (v0.2.0) - Simplest feature, immediately useful for CI integration
2. **Mocking second** (v0.3.0) - Medium complexity, high value for test isolation
3. **Coverage third** (v0.4.0) - Most complex, can be marked experimental
4. **CI/CD fourth** (v0.5.0) - Benefits from TAP output being ready
5. **Distribution last** (v0.6.0) - All features should be stable first

---

## Risk Mitigation

| Risk | Mitigation |
|------|------------|
| Coverage complexity | Mark as "experimental"; accept line-only coverage |
| Builtin mocking limits | Document clearly; fail gracefully with error message |
| Cross-platform issues | CI matrix testing; document known issues |
| Performance overhead | Make coverage opt-in; benchmark each feature |

---

## Success Metrics for v1.0

1. All 3 advanced features working (mocking, TAP, coverage)
2. CI passes on Linux and macOS with bash/zsh
3. npm and Homebrew installation working
4. Self-tests achieve >80% pass rate
5. No critical bugs for 1 week before 1.0 release

---

## Related Documents

- [Core Functionality](01-core-functionality/) - Test runner, assertions, reporting
- [Advanced Features](02-advanced-features/) - Mocking, coverage, TAP specs
- [Documentation & Examples](03-documentation-and-examples/) - README, examples, self-testing
- [Non-Functional Requirements](04-non-functional-requirements/) - Dependencies, system requirements
